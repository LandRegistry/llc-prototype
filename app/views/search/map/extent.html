{% extends "layouts/main.html" %}

{% set serviceName= "Maintain LLC" %}
{% set pageName="Add a charge" %}

{% set bodyClasses = "full-width" %}
{% set containerClasses = "full-width" %}

{% block content %}

<div id="container" class="govuk-grid-row">
  <!--  NAVIGATION  -->
  <div id="navbar" class="govuk-grid-column-20-percent scroll">
    <a class="govuk-back-link" href="javascript: history.go(-1)">Back</a>
    <h2 class="govuk-heading-m">Add an extent</h2>

    {% include "./includes/postcode-search.html" %}

    <p class="govuk-body">
      <ul class="govuk-list">
        <li><a href="search-by-upload" class="govuk-link govuk-link--no-visited-state">Add an extent by uploading a shapefile</a></li>
        <li><a href="search-by-title" class="govuk-link govuk-link--no-visited-state">Add an extent by title number</a></li>
      </ul>
    </p>

    {% include "./includes/controls.html" %}

    {% include "./includes/help.html" %}

    {% include "./includes/footer.html" %}

  </div> 
    

  <!-- MAP  -->
  <div class="govuk-grid-column-three-quarters">

    <div >
      <div class="zoom-controls">
        <button id="zoom-in" class="zoom ol-zoom-in zoom-in" type="button" title="Zoom in">+<span class="govuk-visually-hidden">Zoom in</span></button>
        <button id="zoom-out" class="zoom ol-zoom-out zoom-out" type="button" title="Zoom out">-
          <span class="govuk-visually-hidden">Zoom out</span>
        </button>
      </div>
    </div>
    <div id="map" class="maintain-llc-map" tabindex="0" aria-label="Image showing search extent">
      <!-- <div class="center">
        <div class="horizontal"></div>
        <div class="vertical"></div>
      </div> -->
      <noscript>
        <div id="nojs" class="nojs-content">
          <div id="nojs-message" class="notification-summary">
            <p>
              You need to turn on JavaScript to use this service. Or, for assistance, please use the following link -
              <a id="“assistance-link”"
                href="https://customerhelp.landregistry.gov.uk/local-land-charges">https://customerhelp.landregistry.gov.uk/local-land-charges</a>
            </p>
          </div>
        </div>
      </noscript>
    </div>
    <div class=" govuk-!-padding-top-2">
      <div class="govuk-heading-s ">
        Map key

        <img class="key-image govuk-!-padding-left-3" src="/public/ol/images/information_available.png" alt="Location available key"
          height="19" width="19">
        <span class="key-text govuk-body-s">Location available</span>

        <img class="key-image govuk-!-padding-left-3" src="/public/ol/images/information_not_available.png"
          alt="Location not available key" height="19" width="19">
        <span class="key-text govuk-body-s">Location not available</span>

        <span class="govuk-body-s align-right">
          Use of address and mapping data is subject to <a href="#" target="_blank">Ordnance Survey terms and conditions</a>
        </span>
      </div>
    </div>

  </div>

</div>


<div class="govuk-grid-row">
  <div class="govuk-grid-column-three-quarters">
  </div>
</div>
{% endblock %}





{% block pageScripts %}
  <!--  Custom map styles for this page -->
  <link rel="stylesheet" href="/public/map/css/map-styles.css">

  <!-- Jquery -->
  <script src="/public/map/jquery.min.js"></script>

  <!-- Open Layers -->
  <script src="/public/map/ol.js"></script>
  <script src="/public/map/proj4.js"></script>
  <script src="/public/map/union.js"></script>
  <script src="/public/map/draw_hole.js"></script>

  <!-- Custom Map Styles -->
  <script src="/public/map/hatching_style.js"></script>
  <script src="/public/map/map_styles.js"></script>
  
  <!-- Master Map Vector Layer -->
  <script src="/public/map/master_map_vector_layer.js"></script>
  <script src="/public/map/snap_to_vector_layer.js"></script>
  
  <!-- Custom Map Controls -->
  <script src="/public/map/map_undo_v1.js"></script>
  <script src="/public/map/map_controls.js"></script>
  <script src="/public/map/map_helpers_v1.js"></script>
  
  <!-- Map config -->
  <script src="/public/map/map_config.js"></script>

  <script type="text/javascript">  
    var termsLink = "";
    var mastermap_api_key = "{{ data.API_KEY }}";
    var map_base_layer_view_name = "m0100";
    var wfs_server_url = "{{ data.WFS_URL }}";
    var wmts_server_url = "{{ data.WMTS_URL }}";
  
    MAP_CONFIG.setBaseLayer(MAP_CONFIG.base_layer_zindex, MAP_CONFIG.mastermapResolutions, MAP_CONFIG.projection, termsLink, false);
  </script>
  
   <!-- OpenLayers Map (Note: must be after the key config) -->
  <script src="/public/map/map.js"></script>
  <script src="/public/map/save_geometries.js"></script>

  <!-- Custom actions for this page -->
  <script src="/public/map/keyboard_panning.js"></script>
  <script src="/public/map/postcode_actions.js"></script>
  <script src="/public/map/custom_controls.js"></script>




  
  <script type="text/javascript">
    // Add open layers map controls: this is now only the scale line
    // all other controls are now GDS components
    var controls;
    var center = [];


    MAP_HELPERS.init_controls(map, controls);

    // use this to prepopulate with an extent
    // or in this case to set the initial map bounds
/*     $(function () {
      load_previous_data({ 
        "features": [
          { "geometry": 
            { 
              //set the coordinates to center the map
              "coordinates": [[[532042.65, 181758.8]]],
              "type": "Polygon" 
            },
        "properties": { "id": 10000000000001 },
        "type": "Feature" }],
        "type": "FeatureCollection" });
    }); */

  ///////////////////////////////////////////////
  // initialise including setMode for select area
  ///////////////////////////////////////////////
  $( document ).ready(function() {

    // hack the map height
    let page_height = Math.floor($(window).height());
    $("#map").css("height", page_height - 130);    
    $("#container").css("height", page_height - 120);    
    $('.scroll').css('height', page_height - 70);
    
    // add map event listeners to hide Select area hover state on mouseout
    map.getViewport().addEventListener('mouseover', function(event){
        MASTER_MAP_VECTOR_LAYER.enable()
    }, false);
    map.getViewport().addEventListener('mouseout', function(event){
        MASTER_MAP_VECTOR_LAYER.disable()
    }, false);

    // check the zoom level after zooming in/out and toggle snap-to and select-area options
    map.on('moveend', checkZoom);

    // initialise all the drawing layers based on the selected radio option
    setMode();

    // init
    loadSampleData();
    
    // zoom out to hack bounds box
    const view = map.getView();
    const zoom = view.getZoom();

    let coords =[522200, 168600];
     view.animate({
      center: coords,
      zoom: (zoom - 1),
      duration: 0
    }); 
  });


  function loadSampleData(){   
  console.log('load-----------------');
  
  let info = { 
        "features":
        [
          {
            "geometry": 
            { "coordinates": [
                [
                  [522165.0, 168489.55], [522167.0, 168489.15], [522166.5, 168486.6], [522166.0, 168483.3], [522165.4, 168478.7], [522164.95, 168474.9], [522164.75, 168472.65], [522164.6, 168471.75], [522164.2, 168467.9], [522163.8, 168465.1], [522163.7, 168464.1], [522163.2, 168461.7], [522163.0, 168460.8], [522162.25, 168456.9], [522161.7, 168453.8], [522161.55, 168453.0], [522160.95, 168449.2], [522160.95, 168449.0], [522160.5, 168445.6], [522160.5, 168445.25], [522160.25, 168442.6], [522160.0, 168438.55], [522159.8, 168435.55], [522159.8, 168434.55], [522159.7, 168433.8], [522158.85, 168433.8], [522142.825, 168436.025], [522126.8, 168438.25], [522126.7, 168438.6], [522125.8, 168443.0], [522122.4, 168443.65], [522120.8, 168443.9], [522119.35, 168444.15], [522117.8, 168444.4], [522116.55, 168444.75], [522115.0, 168445.0], [522113.5, 168445.2], [522111.6, 168445.65], [522110.4, 168445.9], [522107.2, 168446.65], [522104.35, 168447.3], [522102.4, 168447.7], [522101.15, 168447.9], [522099.2, 168448.4], [522098.15, 168448.7], [522096.25, 168449.05], [522095.2, 168449.3], [522093.4, 168449.8], [522092.2, 168450.15], [522090.35, 168450.55], [522089.25, 168450.8], [522087.6, 168451.3], [522086.2, 168451.7], [522083.4, 168452.3], [522083.15, 168452.4], [522081.55, 168452.9], [522080.2, 168453.3], [522078.6, 168453.8], [522077.4, 168454.25], [522076.2, 168454.5], [522075.15, 168454.75], [522074.4, 168454.9], [522073.25, 168455.3], [522072.2, 168455.75], [522071.4, 168456.05], [522069.9, 168456.5], [522068.4, 168456.9], [522065.6, 168457.7], [522065.35, 168457.8], [522063.8, 168458.3], [522062.55, 168458.8], [522060.35, 168459.4], [522059.4, 168459.7], [522056.55, 168460.5], [522053.55, 168461.3], [522050.4, 168462.15], [522048.2, 168462.8], [522047.6, 168463.0], [522046.8, 168463.2], [522045.95, 168463.4], [522045.2, 168463.5], [522044.4, 168463.5], [522043.9, 168463.4], [522042.8, 168463.1], [522042.15, 168463.0], [522041.55, 168462.9], [522041.25, 168462.9], [522040.7, 168462.7], [522040.05, 168462.5], [522039.8, 168462.4], [522038.2, 168462.0], [522038.05, 168461.9], [522036.05, 168461.25], [522034.7, 168460.65], [522032.75, 168461.2], [522032.0, 168461.39], [522032.35, 168463.3], [522031.85, 168470.65], [522029.95, 168500.0], [522029.25, 168509.1], [522029.05, 168510.95], [522041.0, 168509.0], [522059.2, 168506.2], [522076.5, 168503.45], [522090.2, 168501.3], [522096.75, 168500.1], [522098.4, 168500.0], [522131.969, 168494.733], [522165.0, 168489.55]
                ]
              ], 
              "type": "Polygon"
            },
            "properties": { "id": 1000 }, 
            "type": "Feature"
          },
          {
            "geometry": 
            { "coordinates": [
                [
                [522106.773, 168512.483], [522093.107, 168514.653], [522075.797, 168517.318], [522062.575, 168519.488], [522048.416, 168521.018], [522032.414, 168520.771], [522021.708, 168520.08], [522004.145, 168518.502], [521994.483, 168517.644], [521993.8, 168550.5], [521993.2, 168583.0], [521992.4, 168620.95], [521992.2, 168638.2], [522000.0, 168638.8], [522036.25, 168641.0], [522050.4, 168641.8], [522064.5, 168642.75], [522081.0, 168643.8], [522094.0, 168644.65], [522109.4, 168645.6], [522124.25, 168646.5], [522133.7, 168647.116], [522134.828, 168642.845], [522136.752, 168640.132], [522138.824, 168637.813], [522139.712, 168636.01], [522141.242, 168606.803], [522142.82, 168578.455], [522143.511, 168552.081], [522143.511, 168549.022], [522142.968, 168547.098], [522141.143, 168544.73], [522135.667, 168540.536], [522128.365, 168534.518], [522121.228, 168526.0], [522112.299, 168514.653], [522111.065, 168513.568], [522108.796, 168512.631], [522106.773, 168512.483]
                ]
              ], 
              "type": "Polygon"
            },
            "properties": { "id": 1001 }, 
            "type": "Feature"
          },
          {
            "geometry": 
            { "coordinates": [
                [
                [522174.8, 168524.0], [522172.9, 168516.45], [522170.35, 168508.0], [522169.15, 168503.7], [522168.4, 168501.4], [522167.9, 168500.0], [522167.6, 168498.8], [522165.0, 168489.55], [522131.969, 168494.733], [522133.483, 168500.876], [522134.677, 168505.491], [522134.153, 168508.804], [522130.773, 168510.455], [522127.045, 168514.377], [522124.93, 168518.846], [522124.592, 168521.874], [522125.671, 168524.978], [522130.27, 168529.831], [522137.11, 168532.671], [522141.742, 168532.8], [522145.698, 168531.898], [522148.11, 168528.465], [522149.757, 168524.286], [522152.391, 168523.401], [522154.952, 168524.218], [522156.481, 168525.521], [522162.415, 168531.302], [522165.2, 168534.762], [522166.731, 168536.254], [522169.102, 168536.884], [522171.084, 168536.764], [522177.452, 168535.157], [522176.75, 168531.95], [522175.7, 168526.95], [522174.8, 168524.0]
                ] 
              ], 
              "type": "Polygon"
            },
            "properties": { "id": 1002 }, 
            "type": "Feature"
          },
          {
            "geometry": 
            { "coordinates": [
              [
                [522237.128, 168434.781], [522207.65, 168437.5], [522166.8, 168442.05], [522167.6, 168454.7], [522172.9, 168487.75], [522176.8, 168500.0], [522177.2, 168501.1], [522177.589, 168502.246], [522178.15, 168503.9], [522179.0, 168506.1], [522180.15, 168508.95], [522180.8, 168510.6], [522182.2, 168514.2], [522182.4, 168514.7], [522183.2, 168516.5], [522183.4, 168517.1], [522183.6, 168518.0], [522184.05, 168520.5], [522184.55, 168523.0], [522185.6, 168528.95], [522187.9, 168541.0], [522189.9, 168552.0], [522190.0, 168552.8], [522191.95, 168563.25], [522192.0, 168563.65], [522193.6, 168573.3], [522193.95, 168575.2], [522195.8, 168586.0], [522197.35, 168596.4], [522197.9, 168600.2], [522198.7, 168607.1], [522198.9, 168610.3], [522198.95, 168610.9], [522199.15, 168613.5], [522199.25, 168616.0], [522199.35, 168617.2], [522199.25, 168619.25], [522199.25, 168620.3], [522199.15, 168623.8], [522198.95, 168626.3], [522198.6, 168629.65], [522197.9, 168636.95], [522197.55, 168639.9], [522197.2, 168643.15], [522197.0, 168646.25], [522196.75, 168651.75], [522196.7, 168653.5], [522199.55, 168653.4], [522207.4, 168653.25], [522212.0, 168653.3], [522223.6, 168653.8], [522238.05, 168654.5], [522249.4, 168655.1], [522261.35, 168655.5], [522269.55, 168655.8], [522279.1, 168656.1], [522294.4, 168656.8], [522306.15, 168657.4], [522315.2, 168657.95], [522318.6, 168658.15], [522320.35, 168658.3], [522323.75, 168658.5], [522327.4, 168658.95], [522330.4, 168659.45], [522333.6, 168659.95], [522337.15, 168662.1], [522357.5, 168663.2], [522362.0, 168663.45], [522370.3, 168660.3], [522371.95, 168659.65], [522369.95, 168656.65], [522372.15, 168600.0], [522373.6, 168560.9], [522374.55, 168535.4], [522375.0, 168527.2], [522375.8, 168516.6], [522376.75, 168506.9], [522377.6, 168500.0], [522377.9, 168496.65], [522379.0, 168479.4], [522380.2, 168459.8], [522381.4, 168442.1], [522381.7, 168440.65], [522365.827, 168439.325], [522363.462, 168439.128], [522363.249, 168443.274], [522349.139, 168442.041], [522343.159, 168442.239], [522336.805, 168446.037], [522336.46, 168447.271], [522337.545, 168454.85], [522346.968, 168455.344], [522346.899, 168456.666], [522346.754, 168459.44], [522374.99, 168461.56], [522373.455, 168482.017], [522372.178, 168496.561], [522374.03, 168496.723], [522371.882, 168525.551], [522369.8, 168525.396], [522368.547, 168542.209], [522367.216, 168560.071], [522308.089, 168555.121], [522310.359, 168521.769], [522312.708, 168492.211], [522313.575, 168482.194], [522311.437, 168482.033], [522311.882, 168476.128], [522312.332, 168470.151], [522297.551, 168471.17], [522297.827, 168475.184], [522291.788, 168475.6], [522291.465, 168470.904], [522283.5, 168471.9], [522283.35, 168471.1], [522275.95, 168472.3], [522275.739, 168470.693], [522255.9, 168472.971], [522255.293, 168467.827], [522241.225, 168469.488], [522240.287, 168461.542], [522237.128, 168434.781]
                ]
              ], 
              "type": "Polygon"
            },
            "properties": { "id": 1003 }, 
            "type": "Feature"
          },
          {
            "geometry": 
            { "coordinates": [
                [
                [522055.469, 168821.28], [522057.26, 168820.686], [522067.519, 168822.308], [522092.011, 168825.404], [522105.134, 168827.938], [522112.177, 168830.079], [522113.21, 168830.393], [522124.805, 168833.459], [522136.42, 168833.111], [522143.998, 168830.964], [522151.371, 168824.359], [522156.283, 168819.688], [522161.744, 168808.969], [522161.9, 168807.85], [522163.0, 168798.85], [522164.6, 168787.85], [522165.6, 168780.9], [522167.35, 168769.1], [522168.95, 168759.3], [522170.2, 168750.9], [522170.8, 168747.3], [522171.15, 168745.45], [522171.35, 168744.5], [522171.6, 168743.5], [522172.0, 168742.5], [522172.5, 168741.3], [522172.6, 168740.95], [522174.6, 168735.7], [522177.7, 168731.2], [522180.05, 168727.45], [522181.55, 168725.3], [522182.9, 168720.0], [522183.8, 168716.25], [522184.2, 168710.7], [522185.05, 168698.5], [522186.0, 168686.65], [522186.55, 168676.5], [522186.75, 168669.95], [522186.9, 168666.7], [522182.25, 168666.3], [522182.5, 168662.95], [522182.6, 168661.8], [522182.6, 168661.3], [522182.55, 168660.25], [522182.4, 168659.65], [522182.2, 168658.45], [522182.0, 168657.9], [522181.75, 168657.15], [522181.4, 168656.5], [522181.05, 168656.0], [522180.6, 168655.45], [522180.55, 168655.3], [522180.25, 168654.95], [522180.0, 168654.5], [522179.75, 168654.3], [522179.4, 168654.2], [522179.05, 168654.0], [522178.7, 168653.8], [522177.95, 168653.65], [522177.4, 168653.5], [522176.0, 168653.4], [522175.55, 168653.4], [522169.05, 168653.0], [522160.35, 168652.45], [522146.55, 168651.7], [522098.15, 168648.5], [522084.2, 168647.7], [522063.2, 168646.3], [522044.5, 168645.15], [522027.9, 168644.15], [522010.15, 168643.25], [522004.856, 168642.93], [522004.791, 168648.083], [522002.692, 168648.059], [522002.6, 168650.65], [522002.15, 168664.6], [522002.1, 168668.8], [522001.8, 168676.2], [522000.0, 168676.2], [521997.6, 168676.2], [521991.3, 168684.4], [521990.8, 168685.1], [521990.5, 168685.7], [521990.2, 168686.45], [521990.2, 168687.9], [521989.4, 168731.95], [521988.4, 168781.05], [521988.5, 168781.85], [521988.5, 168782.35], [521988.6, 168782.95], [521988.75, 168783.2], [521989.0, 168783.5], [521989.2, 168783.7], [521989.55, 168783.95], [521990.4, 168784.45], [522000.0, 168790.15], [522003.25, 168792.2], [522004.75, 168793.1], [522006.85, 168794.25], [522008.1, 168795.05], [522008.85, 168795.45], [522009.2, 168795.55], [522009.827, 168796.013], [522010.6, 168797.15], [522010.55, 168799.45], [522024.8, 168799.85], [522024.962, 168799.853], [522026.294, 168799.877], [522041.407, 168800.148], [522041.084, 168818.143], [522041.062, 168819.385], [522040.757, 168836.348], [522043.511, 168836.712], [522046.468, 168835.049], [522048.206, 168831.289], [522049.301, 168828.079], [522049.662, 168826.928], [522051.447, 168823.614], [522054.274, 168821.676], [522055.469, 168821.28]
                
                ] 
              ], 
              "type": "Polygon"
            },
            "properties": { "id": 1004 }, 
            "type": "Feature"
          },
          {
            "geometry":{ "coordinates": [
              [
              [522167.168, 168819.514], [522167.2, 168819.3], [522168.2, 168811.15], [522169.05, 168803.8], [522169.9, 168797.4], [522170.0, 168796.5], [522170.75, 168791.75], [522171.55, 168785.65], [522172.35, 168778.8], [522173.0, 168773.35], [522173.2, 168771.65], [522173.75, 168767.95], [522173.9, 168767.15], [522174.5, 168763.8], [522174.55, 168763.35], [522175.15, 168759.65], [522175.95, 168755.25], [522176.75, 168750.9], [522176.8, 168750.3], [522177.4, 168747.3], [522177.8, 168746.0], [522178.15, 168745.15], [522178.6, 168744.1], [522178.95, 168743.2], [522179.75, 168741.3], [522180.0, 168740.8], [522181.0, 168738.65], [522181.55, 168737.75], [522182.6, 168735.95], [522184.05, 168733.15], [522184.4, 168732.45], [522185.4, 168730.5], [522185.9, 168729.8], [522186.4, 168728.8], [522186.6, 168728.5], [522187.55, 168726.6], [522187.6, 168726.45], [522188.963, 168727.311], [522191.4, 168728.85], [522197.005, 168720.634], [522198.167, 168718.931], [522199.705, 168716.676], [522197.824, 168715.393], [522197.767, 168715.354], [522198.35, 168714.5], [522199.159, 168713.315], [522201.096, 168714.636], [522204.6, 168709.5], [522202.75, 168708.2], [522205.624, 168703.869], [522206.4, 168702.7], [522210.034, 168697.364], [522212.0, 168698.7], [522216.094, 168695.163], [522222.613, 168689.531], [522222.212, 168689.041], [522220.836, 168687.357], [522225.526, 168683.522], [522226.324, 168684.498], [522227.033, 168685.364], [522227.304, 168685.696], [522233.05, 168682.8], [522232.0, 168680.75], [522238.2, 168677.8], [522238.4, 168678.1], [522239.2, 168679.9], [522245.662, 168676.696], [522263.0, 168668.1], [522265.3, 168667.9], [522266.7, 168668.1], [522270.013, 168669.527], [522276.454, 168671.844], [522286.7, 168673.1], [522298.7, 168673.0], [522298.75, 168680.6], [522299.879, 168680.569], [522302.35, 168680.5], [522302.35, 168684.15], [522298.8, 168684.2], [522298.8, 168687.95], [522298.9, 168694.95], [522300.6, 168697.75], [522304.194, 168703.04], [522313.119, 168716.179], [522310.74, 168717.806], [522313.224, 168721.439], [522324.661, 168728.826], [522328.307, 168731.181], [522325.554, 168735.448], [522325.369, 168735.736], [522323.143, 168739.186], [522308.159, 168729.276], [522305.803, 168726.512], [522303.319, 168722.879], [522303.235, 168722.757], [522283.009, 168696.142], [522275.3, 168686.0], [522274.252, 168683.778], [522268.8, 168685.452], [522267.231, 168680.933], [522266.1, 168679.5], [522263.0, 168675.75], [522231.0, 168691.3], [522217.55, 168702.95], [522197.25, 168732.85], [522196.55, 168732.4], [522199.2, 168737.3], [522270.4, 168818.4], [522294.2, 168845.35], [522301.68, 168852.04], [522296.982, 168851.206], [522292.725, 168850.45], [522292.93, 168845.96], [522290.21, 168845.44], [522263.898, 168840.485], [522244.6, 168836.85], [522171.241, 168820.426], [522167.168, 168819.514]
              ] 
            ], "type": "Polygon"},"properties": { "id": 1005 },"type": "Feature"
          }

        ],
        "type": "FeatureCollection"
      }
    
  // add layer of charge
  //load_previous_data(info);
  // add fake layer to use as highlight
  console.log('load fake data');
  
  load_fake_data(info);    
}

</script>
{% endblock %}